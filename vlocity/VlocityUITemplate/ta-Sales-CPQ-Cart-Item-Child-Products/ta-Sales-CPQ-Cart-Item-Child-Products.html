<div class="cpq-child-products" post-render is-item-details={{attrs.lineItemModal}} ng-controller="cpqCartItemChildProducts as ccicp"
    ng-init="ccicp.init()">
	<div 
		ng-if="attrs.ariaLevel == 1"
		class="slds-tabs--default"
		ng-init="
		    (params.operationCode=='VTPACK' || params.operationCode=='MACDServices') ? productDetails=false : productDetails=true; 
            params.operationCode=='VTPACK' ? optionalPacks=true : optionalPacks=false;
            params.operationCode=='MACDServices' ? productServices=true : productServices=false;
	    ">
		<ul class="slds-tabs--default__nav" role="tablist">
			<li 
				ng-class="{'slds-active' : productDetails}"	
				class="slds-tabs--default__item" 
				title="Item One" 
				role="presentation">
				<a 
					ng-click="productDetails = true; optionalPacks = false; productServices = false;"
					class="slds-tabs--default__link" 
					href="javascript:void(0);" 
					role="tab" 
					tabindex="0" 
					aria-selected="{{productDetails}}" 
					aria-controls="tab-default-1" 
					id="tab-default-1__item">
					Detalles
				</a>
			</li>
			<li 
				ng-class="{'slds-active' : optionalPacks}"
				class="slds-tabs--default__item" 
				title="Item Two" 
				role="presentation">
				<a 
					ng-click="productDetails = false; optionalPacks = true; productServices = false;"
					class="slds-tabs--default__link" 
					href="javascript:void(0);" 
					role="tab" 
					tabindex="-1" 
					aria-selected="{{optionalPacks}}" 
					aria-controls="tab-default-2" 
					id="tab-default-2__item">
					Packs Opcionales
				</a>
			</li>
			<li 
				ng-class="{'slds-active' : productServices}"
				class="slds-tabs--default__item" 
				title="Item Three" 
				role="presentation">
				<a 
					ng-click="productDetails = false; optionalPacks = false; productServices = true;"
					class="slds-tabs--default__link" 
					href="javascript:void(0);" 
					role="tab" 
					tabindex="-1" 
					aria-selected="{{productServices}}" 
					aria-controls="tab-default-2" 
					id="tab-default-2__item">
					Servicios
				</a>
			</li>
		</ul>

		<div 
			ng-show="productDetails"
			id="tab-default-1" 
			class="slds-tabs--default__content" 
			role="tabpanel" 
			aria-labelledby="tab-default-1__item">
			<div ng-repeat="childProd in importedScope.viewModelRecords |filter: attrs.filterKey| orderBy: 'sequenceNumber'">
				<!-- Line Item -->
				<div class="slds-is-relative" ng-if="(childProd.itemType === 'lineItem')">
					<div class="cpq-item-product-messages">
						<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
									{{msg.message}}
									<i ng-init="data.hasError = true"></i>
								</span>
								<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
									{{msg.message}}
								</span>
							</li>
						</ul>
						<ul ng-if="childProd.fieldValidationMessageList.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="fieldValidationMessage in childProd.fieldValidationMessageList"  class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg">{{fieldValidationMessage}}</span>
							</li>
						</ul>
					</div>
					<div class="cpq-item-base-product" ng-class="{'cpq-item-selected':importedScope.isSelected && importedScope.isSelectedItemObjId.value === childProd.Id.value && !attrs.lineItemModal, 'cpq-last-item' : $last}" ng-init="childProdState.show = importedScope.expandMode">
						<div ng-repeat="customField in $root.customViews.cpqCustomViews[$root.customViews.currentCustomView].fields" class="cpq-item-base-product-{{customField.data.classSuffix}}" ng-class="{'cpq-item-currency-value': customField.type === 'currency', 'cpq-item-text-value': customField.type === 'string', 'cpq-item-product-title': customField.name === 'Name'}">
							<!-- Name -->
							<div ng-if="customField.name === 'Name'" class="cpq-item-child-product-name-wrapper">
								<button ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show); importedScope.fullScreen(attrs.ariaLevel, childProdState.show)" class="slds-button cpq-item-has-children" aria-controls="tree0-node1" ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
									<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" extra-classes="'slds-button__icon--left'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
									<span class="slds-assistive-text">Toggle</span>
									<span class="cpq-product-name js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
									<span title="{{childProd[$root.nsPrefix+'Action__c'].value}}">
										<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'bookmark'" extra-classes="'slds-button__icon--left'" class="cpq-product-item-bookmark-{{childProd[$root.nsPrefix+'Action__c'].value.toLowerCase() || 'null'}}"></slds-button-svg-icon>
									</span>  
								</button>
								<div class="cpq-item-no-children" ng-show="!importedScope.checkIfChildProdHasChildren(childProd)">
									{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}
									<span title="{{childProd[$root.nsPrefix+'Action__c'].value}}">
										<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'bookmark'" extra-classes="'slds-button__icon--left'" class="cpq-product-item-bookmark-{{childProd[$root.nsPrefix+'Action__c'].value.toLowerCase() || 'null'}}"></slds-button-svg-icon>
									</span> 
								</div>
							</div>

							<!-- Text -->
							<div ng-if="customField.type === 'string'">{{childProd[customField.fieldName]['value']}}</div>
							<!-- Input -->
							<div class="slds-form-element" ng-if="customField.type === 'input'">
								<div class="slds-form-element__control" ng-class="{'slds-has-error': importedScope[customField.data.validation].indexOf(childProd.Id.value) > -1 }">
									<input type="{{ customField.data.customInputType ? customField.data.customInputType: 'text' }}"    min="{{customField.data.minimum}}" step="any" class="slds-input cpq-item-input" 
										ng-model="childProd[customField.fieldName].value" 
										ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 800, 'blur': 0 } }" 
										ng-change="importedScope.updateLineField(obj, childProd)"
										ng-disabled="importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus) || !importedScope.isQuantityEditable(childProd,customField.fieldName)" 
										ng-required="{{customField.data.required}}" /> 
								</div>
							</div>

							<!-- Price -->
							<div ng-if="customField.type === 'currency'">
								<div cpq-dropdown-handler="showPopover = false">
									<div><strike> {{childProd[customField.fieldName]['originalValue'] | currency}}</strike></div>
									<span ng-class="{'hovered': showPopover, 'cpq-underline' : childProd[customField.fieldName]['actions']['applyadjustment'] || childProd[customField.fieldName]['actions']['pricedetail']}" ng-click="showPopover = !showPopover">
										<span ng-class="{'cpq-item-discount-price' : childProd[customField.fieldName]['originalValue']}">
											{{childProd[customField.fieldName]['value'] | currency}}
										</span>
									</span>

									<div class="slds-popover slds-nubbin--bottom-left cpq-price-actions-popover" role="dialog" ng-show="showPopover && (childProd[customField.fieldName]['actions']['applyadjustment'] || childProd[customField.fieldName]['actions']['pricedetail'])">
			
										<div class="slds-popover__body cpq-price-actions-popover__body">
											<div class="slds-button-group" role="group">
												<button class="slds-button slds-button--icon-border" 
													title="{{::importedScope.customLabels.CPQChangePrice}}"  
													ng-if="childProd[customField.fieldName]['actions']['applyadjustment']"
													ng-click="importedScope.openAdjustmentModal(childProd[customField.fieldName], 'applyadjustment')">
													<slds-button-svg-icon sprite="'utility'" icon="'edit'"></slds-button-svg-icon>
													<span class="slds-assistive-text">{{::importedScope.customLabels.CPQChangePrice}}</span>
												</button>
												<button class="slds-button slds-button--icon-border" aria-haspopup="true"
													title="{{::importedScope.customLabels.CPQPriceDetails}}"  
													ng-if="childProd[customField.fieldName]['actions']['pricedetail']"
													ng-click="importedScope.openAdjustmentModal(childProd[customField.fieldName], 'pricedetail')">
													<slds-button-svg-icon sprite="'utility'" icon="'info'"></slds-button-svg-icon>
													<span class="slds-assistive-text">{{::importedScope.customLabels.CPQPriceDetails}}</span>
												</button>
											</div>
										</div>
									</div>
								</div>    
							</div> 

							<!-- Promotions -->
							<div ng-if="customField.type === 'promo'">
								<div ng-repeat="promoItem in childProd[customField.fieldName].records"
									ng-class="{'cpq-promo-name-strike': importedScope.isPromoActionDisconnect(promoItem)}">
									{{promoItem.Name}}{{$last ? '' : ', '}}
								</div>  
							</div> 
						</div>
						<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-show="childProd.processingLine || attrs.processingLine === 'true'">
							<div class="slds-spinner--brand slds-spinner slds-spinner--small button-spinner" aria-hidden="false" role="alert">
								<div class="slds-spinner__dot-a"></div>
								<div class="slds-spinner__dot-b"></div>
							</div>
						</div>
						<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
							<div ng-if="!importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)" ng-show="$root.customViews.productListHidden" ng-class="{'slds-button-group slds-float--right': importedScope.isMobileTablet}" role="group">
								<button class="slds-button slds-p-horizontal--xx-small" 
									ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
									title="{{::importedScope.customLabels.CPQAddItem}}" 
									ng-click="importedScope.addToCart(obj, childProd)" 
									ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)">
									<slds-button-svg-icon sprite="'utility'" icon="'add'"></slds-button-svg-icon>
									<span class="slds-assistive-text">{{::importedScope.customLabels.CPQAddToCart}}</span>
								</button>

								<button class="slds-button slds-p-horizontal--xx-small" 
									ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
									title="{{::importedScope.customLabels.CPQClone}}" 
									ng-click="importedScope.clone(obj, childProd, $event)" 
									ng-if="childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)">
									<slds-button-svg-icon sprite="'utility'" icon="'copy'"></slds-button-svg-icon>
									<span class="slds-assistive-text">{{::importedScope.customLabels.CPQClone}}</span>
								</button>

								<button class="slds-button slds-p-horizontal--xx-small" 
									ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
									title="{{::importedScope.customLabels.CPQSettings}}" 
									ng-click="importedScope.config(obj, childProd)" 
									ng-if="childProd.actions.updateitems && !attrs.lineItemModal" 
									ng-disabled="childProd.processingLine || attrs.processingLine === 'true'">
									<slds-button-svg-icon sprite="'utility'" icon="'settings'"></slds-button-svg-icon>
									<span class="slds-assistive-text">{{::importedScope.customLabels.CPQSettings}}</span>
								</button>
                                <button class="slds-button slds-p-horizontal--xx-small" 
									ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
									title="{{::importedScope.customLabels.CPQDeleteItem}}"
									ng-click="importedScope.delete(obj, childProd)" 
									ng-if="importedScope.checkCardinalityForDelete(obj, childProd) && childProd.actions.deleteitem" 
									ng-disabled="childProd.processingLine || attrs.processingLine === 'true'">
									<slds-button-svg-icon sprite="'utility'" icon="'close'"></slds-button-svg-icon>
									<span class="slds-assistive-text">{{::importedScope.customLabels.CPQDelete}}</span>
								</button>
							</div>

							<div class="cpq-actions-dropdown-menu-dropdown slds-dropdown-trigger--click cpq-item-actions-dropdown-trigger" ng-if="!$root.customViews.productListHidden" ng-show="!importedScope.isProvisioningStatusDeleted(childProd,attrs.provisioningStatus)" ng-class="{'slds-is-open': lineActions.show}" ng-click="lineActions.show = !lineActions.show">
							    <button cpq-dropdown-handler="lineActions.show = false" aria-haspopup="true" 
									class="slds-button slds-button--icon-border-filled cpq-item-actions-dropdown-button" 
									title="{{::importedScope.customLabels.CPQShowActions}}" 
									ng-if="(childProd.actions.updateitems && !attrs.lineItemModal) || (childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)) || (childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)) || importedScope.checkCardinalityForDelete(obj, childProd)"
									ng-show="childProd.actions"
									>
									<slds-button-svg-icon sprite="'utility'" icon="'down'" extra-classes="'slds-icon-text-default'"></slds-button-svg-icon>
									<span class="slds-assistive-text">{{::importedScope.customLabels.CPQShowActions}}</span>
								</button>
								<div class="slds-dropdown slds-dropdown--right cpq-item-actions-dropdown">
									<ul class="slds-dropdown__list cpq-item-actions-dropdown__list" role="menu">
										<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
											<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
												ng-click="importedScope.addToCart(obj, childProd)" 
												ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)">
												<span class="slds-truncate cpq-action-item-label">
													<slds-svg-icon sprite="'utility'" icon="'add'" size="'x-small'"></slds-svg-icon>
													{{::importedScope.customLabels.CPQAddItem}}
												</span>
											</a>
										</li>
										<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
											<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
												ng-click="importedScope.clone(obj, childProd, $event)" 
												ng-if="childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)">
												<span class="slds-truncate cpq-action-item-label">
													<slds-svg-icon sprite="'utility'" icon="'copy'" size="'x-small'"></slds-svg-icon>
													{{::importedScope.customLabels.CPQClone}}
												</span>
											</a>
										</li>
										<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
											<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
												ng-click="importedScope.config(obj, childProd)"
												ng-if="childProd.actions.updateitems && !attrs.lineItemModal" 
												ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
												<span class="slds-truncate cpq-action-item-label">
													<slds-svg-icon sprite="'utility'" icon="'settings'" size="'x-small'"></slds-svg-icon>
													{{::importedScope.customLabels.CPQConfigure}}
												</span>
											</a>
										</li>
										<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
											<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
												ng-click="importedScope.delete(obj, childProd)"
												ng-if=" importedScope.checkCardinalityForDelete(obj, childProd) && childProd.actions.deleteitem" 
												ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
												<span class="slds-truncate cpq-action-item-label">
													<slds-svg-icon sprite="'utility'" icon="'close'" size="'x-small'"></slds-svg-icon>
													{{::importedScope.customLabels.CPQDelete}}
												</span>
											</a>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<div class="cpq-item-base-product-details">
						<div class="cpq-item-base-product-cfg-attr" ng-if="childProd.attributeCategories.records.length > 0 && childProdState.show && attrs.lineItemModal">
							<div class="slds-section" ng-class="{'slds-is-open': productLineItemToggle}">
							<div class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
								<div class="slds-section__title">
									<a href="javascript:void(0);" ng-click="productLineItemToggle = !productLineItemToggle" ng-init="productLineItemToggle = importedScope.expandMode">
									<button class="slds-button slds-button--icon-container">
										<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !productLineItemToggle}"></slds-button-svg-icon>
									</button>{{::importedScope.customLabels.CPQProductConfig}}</a>
									</span>
								</div>
								<div class="slds-section__content slds-p-left--large slds-m-bottom--small" ng-show="productLineItemToggle">
									<div ng-if="!importedScope.reRenderAttributesForm">
										<vlocity-dynamic-form 
											class="cpq-item-attributes-form slds-form--stacked"
											tooltip-container=".slds-modal"
											form-on-change="importedScope.saveUpdates(e, childProd)"
											name="productconfig{{attrs.lineItemModal?'modal':''}}{{childProd.Id.value}}"
											ng-model="childProd.attributeCategories.records"
											map-object="{{importedScope.mapObject()}}"
											form-auto-save="{{attrs.lineItemModal}}">
										</vlocity-dynamic-form>
									</div>
								</div>
								</div>
							</div>
						</div>
						<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
						<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)"> 
							<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" 
								data="card" records="childProd" nested="true" 
								line-item-modal="{{attrs.lineItemModal}}" 
								aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
								processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
								provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd,attrs.provisioningStatus)}}" show-product-list="{{attrs.showProductList}}"
								show-config-panel="{{attrs.showConfigPanel}}">
							</vloc-layout>
						</div>
					</div>
				</div>
				<!-- Child Product Eg: Add-on-->
				<div ng-if="(childProd.itemType === 'childProduct')">
					<div class="cpq-item-product-messages">
						<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="msg in childProd.messages"  class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
									{{msg.message}}
									<i ng-init="data.hasError = true"></i>
								</span>
								<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
									{{msg.message}}
								</span>
							</li>
						</ul>
					</div>
					<div class="cpq-item-base-product" ng-class="{'cpq-item-selected':importedScope.isSelected && importedScope.isSelectedItemObjId.value === childProd.Id.value && !attrs.lineItemModal, 'cpq-item-last' : $last}" ng-init="childProdState.show = importedScope.expandMode">

						<div ng-repeat="customField in $root.customViews.cpqCustomViews[$root.customViews.currentCustomView].fields" class="cpq-item-base-product-{{customField.data.classSuffix}}" ng-class="{'cpq-item-currency-value': customField.type === 'currency', 'cpq-item-text-value': customField.type === 'string', 'cpq-item-product-title': customField.name === 'Name'}">

							<!-- Name -->
							<div ng-if="customField.name === 'Name'" class="cpq-item-child-product-name-wrapper">
								<button ng-click="childProdState.show = !childProdState.show; importedScope.fullScreen(attrs.ariaLevel, childProdState.show)" class="slds-button cpq-item-has-children" aria-controls="tree0-node1" ng-hide="!(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">
									<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" extra-classes="'slds-button__icon--left'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
									<span class="slds-assistive-text">Toggle</span>
									<span class="cpq-product-name">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
								</button>
								<div class="cpq-item-no-children" ng-show="!(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</div>
							</div>
							<!-- Text -->
							<div ng-if="customField.type === 'string' && customField.name !== 'Name'">
								{{childProd[customField.fieldName]['value']}}
							</div>
							<!-- Input -->
							<div class="slds-form-element" ng-if="customField.type === 'input'">

								<div class="slds-form-element__control " ng-class="{'slds-has-error': importedScope[customField.data.validation].indexOf(childProd.Id.value) > -1 }" ng-if="childProd[customField.fieldName].value">
									<input type="{{ customField.data.customInputType ? customField.data.customInputType: 'text' }}" 
										min="{{customField.data.minimum}}" step="any" class="slds-input cpq-item-input" 
										ng-model="childProd[customField.fieldName].value" 
										ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 800, 'blur': 0 } }" 
										ng-change="importedScope.updateLineField(obj, childProd)"
										ng-disabled="importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)"
										ng-required="{{customField.data.required}}" />
								</div>
							</div>
							<!-- Price -->
							<div ng-if="customField.type === 'currency'">
								{{childProd[customField.fieldName]['value'] | currency: $root.vlocity.userCurrency}}
							</div> 
						</div>
						<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-show="childProd.processingLine || attrs.processingLine === 'true'">
							<div class="slds-spinner--brand slds-spinner slds-spinner--small button-spinner" aria-hidden="false" role="alert">
								<div class="slds-spinner__dot-a"></div>
								<div class="slds-spinner__dot-b"></div>
							</div>
						</div>
						<div class="cpq-item-base-product-actions slds-text-align--right" 
							ng-hide="childProd.processingLine || attrs.processingLine === 'true' || importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)">
						    
							<button class="slds-button slds-button--neutral" ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAddon(obj, childProd)" ng-click="importedScope.addToCart(obj, childProd)">
								{{::importedScope.customLabels.CPQAddToCart}}
							</button>
						</div>
					</div>
					<div class="cpq-item-base-product-details">
						<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">
							<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card"
								data="card" records="childProd" nested="true" 
								line-item-modal="{{attrs.lineItemModal}}" 
								aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
								processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
								provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}"
								show-product-list="{{attrs.showProductList}}"
								show-config-panel="{{attrs.showConfigPanel}}">
							</vloc-layout>
						</div>
					</div>
				</div>
				<!-- Product Group -->
				<div ng-if="(childProd.itemType === 'productGroup' && !(childProd.PricebookEntry.Product2.Name == 'Packs Opcionales' || childProd.Product2.Name == 'Packs Opcionales') && !(childProd.PricebookEntry.Product2.Name == 'Servicios GSM' || childProd.Product2.Name == 'Servicios GSM') && !(childProd.Product2.Name == 'Servicios Basicos' || childProd.PricebookEntry.Product2.Name == 'Servicios Basicos'))">
					<div class="cpq-item-product-messages">
						<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
									{{msg.message}}
									<i ng-init="data.hasError = true"></i>
								</span>
								<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
									{{msg.message}}
								</span>
							</li>
						</ul>
					</div>
					<div class="cpq-item-base-product">
						<div class="cpq-item-base-product-name cpq-item-product-group js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">
						<span class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<button class="slds-button slds-button--icon-small" aria-controls="tree0-node1"
								ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show)"
								ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" 
								ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
								<slds-button-svg-icon sprite="'utility'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
								<span class="slds-assistive-text">Toggle</span>
							</button>
							<span ng-class="{'cpq-item-no-children' : !importedScope.checkIfChildProdHasChildren(childProd)}">{{::(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
						</span>
						</div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-actions slds-text-align--right"></div>
					</div>
					<div class="cpq-item-base-product-details">
						<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
						<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)">
						<!--<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" -->
						<!--    data="card" records="childProd" nested="true" filter-key="filterObj"-->
						<!--    line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" -->
						<!--    processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" -->
						<!--    provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" -->
						<!--    show-product-list="{{attrs.showProductList}}"-->
						<!--    show-config-panel="{{attrs.showConfigPanel}}">-->
						<!--    </vloc-layout>-->
						<vloc-layout layout-name="ta-Sales-CPQ-Cart-Item-Product-Children" ctrl="" ng-model="card" 
							data="card" records="childProd" nested="true"
							line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
							processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
							provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" 
							show-product-list="{{attrs.showProductList}}"
							show-config-panel="{{attrs.showConfigPanel}}">
							</vloc-layout>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div
			ng-show="optionalPacks" 
			id="tab-default-2" 
			class="slds-tabs--default__content slds-show" 
			role="tabpanel" 
			aria-labelledby="tab-default-2__item">
			<div ng-repeat="childProd in importedScope.viewModelRecords |filter: attrs.filterKey| orderBy: 'sequenceNumber'">
				<!-- Product Group -->
				<div ng-if="(childProd.itemType === 'productGroup' && (childProd.PricebookEntry.Product2.Name == 'Packs Opcionales' || childProd.Product2.Name == 'Packs Opcionales'))">
					<div class="cpq-item-product-messages">
						<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
									{{msg.message}}
									<i ng-init="data.hasError = true"></i>
								</span>
								<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
									{{msg.message}}
								</span>
							</li>
						</ul>
					</div>
					<div class="cpq-item-base-product">
						<!-- <div class="cpq-item-base-product-name cpq-item-product-group js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">
							<span class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
								<button class="slds-button slds-button--icon-small" aria-controls="tree0-node1"
									ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show)"
									ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" 
									ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
									<slds-button-svg-icon sprite="'utility'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
									<span class="slds-assistive-text">Toggle</span>
								</button>
								<span ng-class="{'cpq-item-no-children' : !importedScope.checkIfChildProdHasChildren(childProd)}">{{::(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
							</span>
						</div> -->
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-actions slds-text-align--right"></div>
					</div>
					<div class="cpq-item-base-product-details">
						<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
						
						<!-- ng-show="childProdState.show"  -->
						<div ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)">
						<!--<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" -->
						<!--    data="card" records="childProd" nested="true" filter-key="filterObj"-->
						<!--    line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" -->
						<!--    processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" -->
						<!--    provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" -->
						<!--    show-product-list="{{attrs.showProductList}}"-->
						<!--    show-config-panel="{{attrs.showConfigPanel}}">-->
						<!--    </vloc-layout>-->
						<vloc-layout layout-name="ta-Sales-CPQ-Cart-Item-Product-Children" ctrl="" ng-model="card" 
							data="card" records="childProd" nested="true"
							line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
							processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
							provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" 
							show-product-list="{{attrs.showProductList}}"
							show-config-panel="{{attrs.showConfigPanel}}">
							</vloc-layout>
						</div>
					</div>
				</div>
			</div>
        </div>
        <div
            ng-show="productServices" 
            id="tab-default-2" 
            class="slds-tabs--default__content slds-show" 
            role="tabpanel" 
            aria-labelledby="tab-default-2__item">
            <div ng-repeat="childProd in importedScope.viewModelRecords |filter: attrs.filterKey| orderBy: 'sequenceNumber'">
                <!-- Product Group -->
                <div ng-if="(childProd.itemType === 'productGroup' && (childProd.PricebookEntry.Product2.Name == 'Servicios GSM' || childProd.Product2.Name == 'Servicios GSM' || childProd.Product2.Name == 'Servicios Basicos' || childProd.PricebookEntry.Product2.Name == 'Servicios Basicos'))">
					<div class="cpq-item-product-messages">
						<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
								<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
									{{msg.message}}
									<i ng-init="data.hasError = true"></i>
								</span>
								<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
									{{msg.message}}
								</span>
							</li>
						</ul>
					</div>
					<div class="cpq-item-base-product">
						<div class="cpq-item-base-product-name cpq-item-product-group js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">
						<span class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
							<button class="slds-button slds-button--icon-small" aria-controls="tree0-node1"
								ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show)"
								ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" 
								ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
								<slds-button-svg-icon sprite="'utility'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
								<span class="slds-assistive-text">Toggle</span>
							</button>
							<span ng-class="{'cpq-item-no-children' : !importedScope.checkIfChildProdHasChildren(childProd)}">{{::(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
						</span>
						</div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-input"></div>
						<div class="cpq-item-base-product-actions slds-text-align--right"></div>
					</div>
					<div class="cpq-item-base-product-details">
						<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
						<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)">
						<!--<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" -->
						<!--    data="card" records="childProd" nested="true" filter-key="filterObj"-->
						<!--    line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" -->
						<!--    processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" -->
						<!--    provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" -->
						<!--    show-product-list="{{attrs.showProductList}}"-->
						<!--    show-config-panel="{{attrs.showConfigPanel}}">-->
						<!--    </vloc-layout>-->
						<vloc-layout layout-name="ta-Sales-CPQ-Cart-Item-Product-Children" ctrl="" ng-model="card" 
							data="card" records="childProd" nested="true"
							line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
							processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
							provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" 
							show-product-list="{{attrs.showProductList}}"
							show-config-panel="{{attrs.showConfigPanel}}">
							</vloc-layout>
						</div>
					</div>
                </div>
            </div>
        </div>
	</div>


	<div 
		ng-if="attrs.ariaLevel != 1"
		ng-repeat="childProd in importedScope.viewModelRecords |filter: attrs.filterKey| orderBy: 'sequenceNumber'">
		<!-- Line Item -->
		<div class="slds-is-relative" ng-if="(childProd.itemType === 'lineItem')">
			<div class="cpq-item-product-messages">
				<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
					<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
						<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
							{{msg.message}}
							<i ng-init="data.hasError = true"></i>
						</span>
						<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
							{{msg.message}}
						</span>
					</li>
				</ul>
				<ul ng-if="childProd.fieldValidationMessageList.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
					<li ng-repeat="fieldValidationMessage in childProd.fieldValidationMessageList"  class="slds-p-vertical--xx-small">
						<span class="cpq-error-msg js-error-msg">{{fieldValidationMessage}}</span>
					</li>
				</ul>
			</div>
			<div class="cpq-item-base-product" ng-class="{'cpq-item-selected':importedScope.isSelected && importedScope.isSelectedItemObjId.value === childProd.Id.value && !attrs.lineItemModal, 'cpq-last-item' : $last}" ng-init="childProdState.show = importedScope.expandMode">
				<div ng-repeat="customField in $root.customViews.cpqCustomViews[$root.customViews.currentCustomView].fields" class="cpq-item-base-product-{{customField.data.classSuffix}}" ng-class="{'cpq-item-currency-value': customField.type === 'currency', 'cpq-item-text-value': customField.type === 'string', 'cpq-item-product-title': customField.name === 'Name'}">
					<!-- Name -->
					<div ng-if="customField.name === 'Name'" class="cpq-item-child-product-name-wrapper">
						<button ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show); importedScope.fullScreen(attrs.ariaLevel, childProdState.show)" class="slds-button cpq-item-has-children" aria-controls="tree0-node1" ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
							<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" extra-classes="'slds-button__icon--left'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
							<span class="slds-assistive-text">Toggle</span>
							<span class="cpq-product-name js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
							<span title="{{childProd[$root.nsPrefix+'Action__c'].value}}">
								<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'bookmark'" extra-classes="'slds-button__icon--left'" class="cpq-product-item-bookmark-{{childProd[$root.nsPrefix+'Action__c'].value.toLowerCase() || 'null'}}"></slds-button-svg-icon>
							</span>  
						</button>
						<div class="cpq-item-no-children" ng-show="!importedScope.checkIfChildProdHasChildren(childProd)">
							{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}
							<span title="{{childProd[$root.nsPrefix+'Action__c'].value}}">
								<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'bookmark'" extra-classes="'slds-button__icon--left'" class="cpq-product-item-bookmark-{{childProd[$root.nsPrefix+'Action__c'].value.toLowerCase() || 'null'}}"></slds-button-svg-icon>
							</span> 
						</div>
					</div>

					<!-- Text -->
					<div ng-if="customField.type === 'string'">{{childProd[customField.fieldName]['value']}}</div>
					<!-- Input -->
					<div class="slds-form-element" ng-if="customField.type === 'input'">
						<div class="slds-form-element__control" ng-class="{'slds-has-error': importedScope[customField.data.validation].indexOf(childProd.Id.value) > -1 }">
							<input type="{{ customField.data.customInputType ? customField.data.customInputType: 'text' }}"    min="{{customField.data.minimum}}" step="any" class="slds-input cpq-item-input" 
								ng-model="childProd[customField.fieldName].value" 
								ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 800, 'blur': 0 } }" 
								ng-change="importedScope.updateLineField(obj, childProd)"
								ng-disabled="importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus) || !importedScope.isQuantityEditable(childProd,customField.fieldName)" 
								ng-required="{{customField.data.required}}" /> 
						</div>
					</div>

					<!-- Price -->
					<div ng-if="customField.type === 'currency'">
						<div cpq-dropdown-handler="showPopover = false">
							<div><strike> {{childProd[customField.fieldName]['originalValue'] | currency}}</strike></div>
							<span ng-class="{'hovered': showPopover, 'cpq-underline' : childProd[customField.fieldName]['actions']['applyadjustment'] || childProd[customField.fieldName]['actions']['pricedetail']}" ng-click="showPopover = !showPopover">
								<span ng-class="{'cpq-item-discount-price' : childProd[customField.fieldName]['originalValue']}">
									{{childProd[customField.fieldName]['value'] | currency}}
								</span>
							</span>

							<div class="slds-popover slds-nubbin--bottom-left cpq-price-actions-popover" role="dialog" ng-show="showPopover && (childProd[customField.fieldName]['actions']['applyadjustment'] || childProd[customField.fieldName]['actions']['pricedetail'])">
		
								<div class="slds-popover__body cpq-price-actions-popover__body">
									<div class="slds-button-group" role="group">
										<button class="slds-button slds-button--icon-border" 
											title="{{::importedScope.customLabels.CPQChangePrice}}"  
											ng-if="childProd[customField.fieldName]['actions']['applyadjustment']"
											ng-click="importedScope.openAdjustmentModal(childProd[customField.fieldName], 'applyadjustment')">
											<slds-button-svg-icon sprite="'utility'" icon="'edit'"></slds-button-svg-icon>
											<span class="slds-assistive-text">{{::importedScope.customLabels.CPQChangePrice}}</span>
										</button>
										<button class="slds-button slds-button--icon-border" aria-haspopup="true"
											title="{{::importedScope.customLabels.CPQPriceDetails}}"  
											ng-if="childProd[customField.fieldName]['actions']['pricedetail']"
											ng-click="importedScope.openAdjustmentModal(childProd[customField.fieldName], 'pricedetail')">
											<slds-button-svg-icon sprite="'utility'" icon="'info'"></slds-button-svg-icon>
											<span class="slds-assistive-text">{{::importedScope.customLabels.CPQPriceDetails}}</span>
										</button>
									</div>
								</div>
							</div>
						</div>    
					</div> 

						<!-- Promotions -->
					<div ng-if="customField.type === 'promo'">
						<div ng-repeat="promoItem in childProd[customField.fieldName].records"
							ng-class="{'cpq-promo-name-strike': importedScope.isPromoActionDisconnect(promoItem)}">
							{{promoItem.Name}}{{$last ? '' : ', '}}
						</div>  
					</div> 
				</div>
				<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-show="childProd.processingLine || attrs.processingLine === 'true'">
					<div class="slds-spinner--brand slds-spinner slds-spinner--small button-spinner" aria-hidden="false" role="alert">
						<div class="slds-spinner__dot-a"></div>
						<div class="slds-spinner__dot-b"></div>
					</div>
				</div>
				<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
					<div ng-if="!importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)" ng-show="$root.customViews.productListHidden" ng-class="{'slds-button-group slds-float--right': importedScope.isMobileTablet}" role="group">
						<button class="slds-button slds-p-horizontal--xx-small" 
							ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
							title="{{::importedScope.customLabels.CPQAddItem}}" 
							ng-click="importedScope.addToCart(obj, childProd)" 
							ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)">
							<slds-button-svg-icon sprite="'utility'" icon="'add'"></slds-button-svg-icon>
							<span class="slds-assistive-text">{{::importedScope.customLabels.CPQAddToCart}}</span>
						</button>

						<button class="slds-button slds-p-horizontal--xx-small" 
							ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
							title="{{::importedScope.customLabels.CPQClone}}" 
							ng-click="importedScope.clone(obj, childProd, $event)" 
							ng-if="childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)">
							<slds-button-svg-icon sprite="'utility'" icon="'copy'"></slds-button-svg-icon>
							<span class="slds-assistive-text">{{::importedScope.customLabels.CPQClone}}</span>
						</button>

						<button class="slds-button slds-p-horizontal--xx-small" 
							ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
							title="{{::importedScope.customLabels.CPQSettings}}" 
							ng-click="importedScope.config(obj, childProd)" 
							ng-if="childProd.actions.updateitems && !attrs.lineItemModal" 
							ng-disabled="childProd.processingLine || attrs.processingLine === 'true'">
							<slds-button-svg-icon sprite="'utility'" icon="'settings'"></slds-button-svg-icon>
							<span class="slds-assistive-text">{{::importedScope.customLabels.CPQSettings}}</span>
						</button>
                        <!--<pre>Child Prod: {{childProd | json}}</pre>-->
						<button class="slds-button slds-p-horizontal--xx-small" 
							ng-class="{'slds-button--icon-border': importedScope.isMobileTablet}"
							title="{{::importedScope.customLabels.CPQDeleteItem}}"
							ng-click="importedScope.delete(obj, childProd)" 
							ng-if="importedScope.checkCardinalityForDelete(obj, childProd) && childProd.actions.deleteitem" 
							ng-disabled="childProd.processingLine || attrs.processingLine === 'true'">
							<slds-button-svg-icon sprite="'utility'" icon="'close'"></slds-button-svg-icon>
							<span class="slds-assistive-text">{{::importedScope.customLabels.CPQDelete}}</span>
						</button>
					</div>

					<div class="cpq-actions-dropdown-menu-dropdown slds-dropdown-trigger--click cpq-item-actions-dropdown-trigger" ng-if="!$root.customViews.productListHidden" ng-show="!importedScope.isProvisioningStatusDeleted(childProd,attrs.provisioningStatus)" ng-class="{'slds-is-open': lineActions.show}" ng-click="lineActions.show = !lineActions.show">
						<button cpq-dropdown-handler="lineActions.show = false" aria-haspopup="true" 
							class="slds-button slds-button--icon-border-filled cpq-item-actions-dropdown-button" 
							title="{{::importedScope.customLabels.CPQShowActions}}" 
							ng-if="(childProd.actions.updateitems && !attrs.lineItemModal) || (childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)) || (childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)) || importedScope.checkCardinalityForDelete(obj, childProd)"
							ng-show="childProd.actions"
							>
							<slds-button-svg-icon sprite="'utility'" icon="'down'" extra-classes="'slds-icon-text-default'"></slds-button-svg-icon>
							<span class="slds-assistive-text">{{::importedScope.customLabels.CPQShowActions}}</span>
						</button>
						<div class="slds-dropdown slds-dropdown--right cpq-item-actions-dropdown">
							<ul class="slds-dropdown__list cpq-item-actions-dropdown__list" role="menu">
								<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
									<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
										ng-click="importedScope.addToCart(obj, childProd)" 
										ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAdd(obj, childProd)">
										<span class="slds-truncate cpq-action-item-label">
											<slds-svg-icon sprite="'utility'" icon="'add'" size="'x-small'"></slds-svg-icon>
											{{::importedScope.customLabels.CPQAddItem}}
										</span>
									</a>
								</li>
								<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
									<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
										ng-click="importedScope.clone(obj, childProd, $event)" 
										ng-if="childProd.actions.cloneitem && importedScope.checkCardinalityForClone(obj, childProd)">
										<span class="slds-truncate cpq-action-item-label">
											<slds-svg-icon sprite="'utility'" icon="'copy'" size="'x-small'"></slds-svg-icon>
											{{::importedScope.customLabels.CPQClone}}
										</span>
									</a>
								</li>
								<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
									<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
										ng-click="importedScope.config(obj, childProd)"
										ng-if="childProd.actions.updateitems && !attrs.lineItemModal" 
										ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
										<span class="slds-truncate cpq-action-item-label">
											<slds-svg-icon sprite="'utility'" icon="'settings'" size="'x-small'"></slds-svg-icon>
											{{::importedScope.customLabels.CPQConfigure}}
										</span>
									</a>
								</li>
								<li class="slds-dropdown__item cpq-item-actions-dropdown__item" role="presentation">
									<a href="javascript:void(0);" role="menuitemcheckbox" aria-checked="true" tabindex="0" 
										ng-click="importedScope.delete(obj, childProd)"
										ng-if=" importedScope.checkCardinalityForDelete(obj, childProd) && childProd.actions.deleteitem" 
										ng-hide="childProd.processingLine || attrs.processingLine === 'true'">
										<span class="slds-truncate cpq-action-item-label">
											<slds-svg-icon sprite="'utility'" icon="'close'" size="'x-small'"></slds-svg-icon>
											{{::importedScope.customLabels.CPQDelete}}
										</span>
									</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="cpq-item-base-product-details">
				<div class="cpq-item-base-product-cfg-attr" ng-if="childProd.attributeCategories.records.length > 0 && childProdState.show && attrs.lineItemModal">
					<div class="slds-section" ng-class="{'slds-is-open': productLineItemToggle}">
						<div class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
						<div class="slds-section__title">
							<a href="javascript:void(0);" ng-click="productLineItemToggle = !productLineItemToggle" ng-init="productLineItemToggle = importedScope.expandMode">
							<button class="slds-button slds-button--icon-container">
								<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !productLineItemToggle}"></slds-button-svg-icon>
							</button>{{::importedScope.customLabels.CPQProductConfig}}</a>
							</span>
						</div>
						<div class="slds-section__content slds-p-left--large slds-m-bottom--small" ng-show="productLineItemToggle">
							<div ng-if="!importedScope.reRenderAttributesForm">
								<vlocity-dynamic-form 
									class="cpq-item-attributes-form slds-form--stacked"
									tooltip-container=".slds-modal"
									form-on-change="importedScope.saveUpdates(e, childProd)"
									name="productconfig{{attrs.lineItemModal?'modal':''}}{{childProd.Id.value}}"
									ng-model="childProd.attributeCategories.records"
									map-object="{{importedScope.mapObject()}}"
									form-auto-save="{{attrs.lineItemModal}}">
								</vlocity-dynamic-form>
							</div>
						</div>
						</div>
					</div>
				</div>
				<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
				<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)"> 
					<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" 
						data="card" records="childProd" nested="true" 
						line-item-modal="{{attrs.lineItemModal}}" 
						aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
						processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
						provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd,attrs.provisioningStatus)}}" show-product-list="{{attrs.showProductList}}"
						show-config-panel="{{attrs.showConfigPanel}}">
					</vloc-layout>
				</div>
			</div>
		</div>
		<!-- Child Product Eg: Add-on-->
		<div ng-if="(childProd.itemType === 'childProduct')">
			<div class="cpq-item-product-messages">
				<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
					<li ng-repeat="msg in childProd.messages"  class="slds-p-vertical--xx-small">
						<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
							{{msg.message}}
							<i ng-init="data.hasError = true"></i>
						</span>
						<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
							{{msg.message}}
						</span>
					</li>
				</ul>
			</div>
			<div class="cpq-item-base-product" ng-class="{'cpq-item-selected':importedScope.isSelected && importedScope.isSelectedItemObjId.value === childProd.Id.value && !attrs.lineItemModal, 'cpq-item-last' : $last}" ng-init="childProdState.show = importedScope.expandMode">

				<div ng-repeat="customField in $root.customViews.cpqCustomViews[$root.customViews.currentCustomView].fields" class="cpq-item-base-product-{{customField.data.classSuffix}}" ng-class="{'cpq-item-currency-value': customField.type === 'currency', 'cpq-item-text-value': customField.type === 'string', 'cpq-item-product-title': customField.name === 'Name'}">

					<!-- Name -->
					<div ng-if="customField.name === 'Name'" class="cpq-item-child-product-name-wrapper">
						<button ng-click="childProdState.show = !childProdState.show; importedScope.fullScreen(attrs.ariaLevel, childProdState.show)" class="slds-button cpq-item-has-children" aria-controls="tree0-node1" ng-hide="!(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">
							<slds-button-svg-icon sprite="'utility'" size="'small'" icon="'switch'" extra-classes="'slds-button__icon--left'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
							<span class="slds-assistive-text">Toggle</span>
							<span class="cpq-product-name">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
						</button>
						<div class="cpq-item-no-children" ng-show="!(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">{{(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</div>
					</div>
					<!-- Text -->
					<div ng-if="customField.type === 'string' && customField.name !== 'Name'">
						{{childProd[customField.fieldName]['value']}}
					</div>
					<!-- Input -->
					<div class="slds-form-element" ng-if="customField.type === 'input'">

						<div class="slds-form-element__control " ng-class="{'slds-has-error': importedScope[customField.data.validation].indexOf(childProd.Id.value) > -1 }" ng-if="childProd[customField.fieldName].value">
							<input type="{{ customField.data.customInputType ? customField.data.customInputType: 'text' }}" 
								min="{{customField.data.minimum}}" step="any" class="slds-input cpq-item-input" 
								ng-model="childProd[customField.fieldName].value" 
								ng-model-options="{ updateOn: 'default blur', debounce: { 'default': 800, 'blur': 0 } }" 
								ng-change="importedScope.updateLineField(obj, childProd)"
								ng-disabled="importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)"
								ng-required="{{customField.data.required}}" />
						</div>
					</div>
					<!-- Price -->
					<div ng-if="customField.type === 'currency'">
						{{childProd[customField.fieldName]['value'] | currency: $root.vlocity.userCurrency}}
					</div> 
				</div>
				<div class="cpq-item-base-product-actions slds-text-align--right" ng-class="{'compacted': !$root.customViews.productListHidden}" ng-show="childProd.processingLine || attrs.processingLine === 'true'">
					<div class="slds-spinner--brand slds-spinner slds-spinner--small button-spinner" aria-hidden="false" role="alert">
						<div class="slds-spinner__dot-a"></div>
						<div class="slds-spinner__dot-b"></div>
					</div>
				</div>
				<div class="cpq-item-base-product-actions slds-text-align--right" 
					ng-hide="childProd.processingLine || attrs.processingLine === 'true' || importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)">
				    <!--<pre>{{obj | json}}</pre>-->
					<button class="slds-button slds-button--neutral" ng-if="childProd.actions.addtocart && importedScope.checkCardinalityForAddon(obj, childProd)" ng-click="importedScope.addToCart(obj, childProd)">
						{{::importedScope.customLabels.CPQAddToCart}}
					</button>
				</div>
			</div>
			<div class="cpq-item-base-product-details">
				<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records)">
					<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card"
						data="card" records="childProd" nested="true" 
						line-item-modal="{{attrs.lineItemModal}}" 
						aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
						processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
						provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}"
						show-product-list="{{attrs.showProductList}}"
						show-config-panel="{{attrs.showConfigPanel}}">
					</vloc-layout>
				</div>
			</div>
		</div>
		<!-- Product Group -->
		<div ng-if="(childProd.itemType === 'productGroup')">
			<div class="cpq-item-product-messages">
				<ul ng-if="childProd.messages.length > 0" class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
					<li ng-repeat="msg in childProd.messages" class="slds-p-vertical--xx-small">
						<span class="cpq-error-msg js-error-msg-{{msg.messageId}}" ng-if="msg.severity === 'ERROR'">
							{{msg.message}}
							<i ng-init="data.hasError = true"></i>
						</span>
						<span class="cpq-warning-msg" ng-if="msg.severity !== 'ERROR'">
							{{msg.message}}
						</span>
					</li>
				</ul>
			</div>
			<div class="cpq-item-base-product">
				<div class="cpq-item-base-product-name cpq-item-product-group js-cpq-cart-product-hierarchy-path-{{childProd.productHierarchyPath}}">
					<span class="cpq-item-product-child-level-{{(attrs.ariaLevel)}} cpq-item-child-product-name-wrapper">
					<button class="slds-button slds-button--icon-small" aria-controls="tree0-node1"
						ng-click="childProdState.show = importedScope.determineChildProdOpenOrCloseAfterClick(childProd, childProdState.show)"
						ng-hide="importedScope.determineIfChildProdOpenOrCloseIconShouldBeHidden(childProd)" 
						ng-init="childProdState.show = importedScope.determineChildProdOpenOrCloseInitially(childProd)">
						<slds-button-svg-icon sprite="'utility'" icon="'switch'" ng-class="{'fix-slds-close-switch' : !childProdState.show}"></slds-button-svg-icon>
						<span class="slds-assistive-text">Toggle</span>
					</button>
					<span ng-class="{'cpq-item-no-children' : !importedScope.checkIfChildProdHasChildren(childProd)}">{{::(childProd.PricebookEntry.Product2.Name || childProd.Product2.Name)}}</span>
					</span>
				</div>
				<div class="cpq-item-base-product-input"></div>
				<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
				<div class="cpq-item-base-product-currency cpq-item-currency-value"></div>
				<div class="cpq-item-base-product-input"></div>
				<div class="cpq-item-base-product-input"></div>
				<div class="cpq-item-base-product-actions slds-text-align--right"></div>
			</div>
			<div class="cpq-item-base-product-details">
				<!-- The reason for the following checks involving getproducts (which implies field is configured as collapsable) is to make sure the search bar is shown even if there is no children under the collapsable field, as long as childProdState.show is true (expanded) -->
				<div ng-show="childProdState.show" ng-if="(childProd.lineItems.records || childProd.childProducts.records || childProd.productGroups.records || childProd.actions.getproducts)">
				<!--<vloc-layout layout-name="cpq-cart-item-product-children" ctrl="" ng-model="card" -->
				<!--    data="card" records="childProd" nested="true" filter-key="filterObj"-->
				<!--    line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" -->
				<!--    processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" -->
				<!--    provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" -->
				<!--    show-product-list="{{attrs.showProductList}}"-->
				<!--    show-config-panel="{{attrs.showConfigPanel}}">-->
				<!--    </vloc-layout>-->
				<vloc-layout layout-name="ta-Sales-CPQ-Cart-Item-Product-Children" ctrl="" ng-model="card" 
					data="card" records="childProd" nested="true"
					line-item-modal="{{attrs.lineItemModal}}" aria-level="{{(attrs.ariaLevel - 0) + 0}}" 
					processing-line="{{childProd.processingLine || attrs.processingLine === 'true'}}" 
					provisioning-status="{{importedScope.isProvisioningStatusDeleted(childProd, attrs.provisioningStatus)}}" 
					show-product-list="{{attrs.showProductList}}"
					show-config-panel="{{attrs.showConfigPanel}}">
					</vloc-layout>
				</div>
			</div>
		</div>
	</div>